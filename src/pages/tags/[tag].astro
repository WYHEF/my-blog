---
import BaseLayout from '@layouts/BaseLayout.astro';
import PostCard from '@components/PostCard.astro';
import { getAllTags, getPostsByTag } from '@/utils/post';
import { SITE_CONFIG } from '@/config';

export async function getStaticPaths() {
  const tags = await getAllTags();
  
  return Promise.all(
    tags.map(async ({ tag }) => {
      const posts = await getPostsByTag(tag);
      return {
        params: { tag },
        props: { posts, tag }
      };
    })
  );
}

const { posts, tag } = Astro.props;
---

<BaseLayout
  title={`#${tag} - ${SITE_CONFIG.title}`}
  description={`Posts tagged with ${tag}`}
>
  <div class="container">
    <header class="tag-header">
      <h1 class="tag-title">#{tag}</h1>
      <p class="tag-count">{posts.length} posts</p>
    </header>
    
    <div class="posts-list">
      {posts.map((post) => (
        <PostCard post={post} />
      ))}
    </div>
  </div>
</BaseLayout>

<style>
  .tag-header {
    padding: var(--spacing-xl) 0;
    margin-bottom: var(--spacing-lg);
    border-bottom: 1px solid var(--color-border);
  }
  
  .tag-title {
    font-size: 2.5rem;
    color: var(--color-text);
    margin-bottom: var(--spacing-sm);
  }
  
  .tag-count {
    font-size: 1rem;
    color: var(--color-text-secondary);
  }
  
  .posts-list {
    display: flex;
    flex-direction: column;
  }
</style>

